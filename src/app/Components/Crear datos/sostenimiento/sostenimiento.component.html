<!-- Contenedor principal -->
<div class="form-container">
  <!-- Título principal -->
  <div class="titulo">
    <h1>Crear nueva datapara sostenimiento</h1>
    <p>Seleccione el tipo de dato que desea crear o gestionar</p>
  </div>

  <!-- Botones de opciones -->
  <div class="ventana">
    <div class="button-container-wrapper">
      <div
        class="button-container"
        *ngFor="let button of buttonc"
        (click)="abrirModal(button)"
      >
        <img [src]="button.icon" alt="Ícono" class="button-icon" />
        <p class="button-nombre">{{ button.nombre }}</p>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal-overlay" *ngIf="modalAbierto">
  <div class="modal">
    <button class="close-icon" (click)="cerrarModal()">
      <mat-icon>close</mat-icon>
    </button>

    <div class="modal-content">
      <div class="subtitu">
        <h2>{{ modalContenido?.nombre }}</h2>
        <p>
          {{ editando ? "Editando " : "Creación del tipo de "
          }}{{ modalContenido?.nombre }}
        </p>
      </div>

      <!-- FORMULARIO DEL MODAL -->
      <form
        (submit)="editando ? actualizarDatos() : guardarDatos()"
        class="forme"
      >
        <div class="form-group" *ngFor="let campo of modalContenido?.campos">
          <label>{{ campo.label }}</label>
          <div class="input-container">
            <!-- Si es SELECT -->
            <ng-container *ngIf="campo.tipo === 'select'; else inputField">
              <select
                [(ngModel)]="nuevoDato[campo.nombre]"
                [name]="campo.nombre"
                required
                class="form-input"
                (change)="onCampoChange(campo.nombre)"
              >
                <option *ngFor="let opcion of campo.opciones" [value]="opcion">
                  {{ opcion }}
                </option>
              </select>
            </ng-container>

            <!-- Si es INPUT -->
            <ng-template #inputField>
              <input
                [type]="campo.tipo"
                [(ngModel)]="nuevoDato[campo.nombre]"
                [name]="campo.nombre"
                required
                class="form-input"
              />
            </ng-template>
          </div>
        </div>

        <!-- BOTONES DEL FORMULARIO -->
        <div class="button-group">
          <ng-container *ngIf="!editando; else editButtons">
            <button type="submit" class="btn-submit">
              <mat-icon>save</mat-icon>
              Guardar
            </button>
            <button
  type="button"
  class="btn-submit secondary"
  (click)="triggerFileInput()"
>
  <mat-icon>upload_file</mat-icon>
  Importar Excel
</button>

            <input
              type="file"
              id="fileInput"
              style="display: none"
              (change)="procesarArchivoExcel($event)"
              accept=".xlsx, .xls"
            />
          </ng-container>

          <ng-template #editButtons>
            <button type="submit" class="btn-submit">
              <mat-icon>update</mat-icon>
              Actualizar
            </button>
            <button type="button" class="btn-submit secondary">
              <mat-icon>cancel</mat-icon>
              Cancelar
            </button>
          </ng-template>
        </div>
      </form>

      <!-- TABLA DENTRO DEL MODAL -->
      <div class="tabla-scroll">
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th *ngFor="let campo of modalContenido?.campos">
                {{ campo.label }}
              </th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let dato of modalContenido?.datos; let i = index">
              <td>{{ i + 1 }}</td>
              <td *ngFor="let campo of modalContenido?.campos">
                {{ dato[campo.nombre] }}
              </td>
              <td class="actions-cell">
                <button
                  class="action-btn edit"
                  (click)="editarDato(dato, i)"
                  title="Editar"
                >
                  <mat-icon>edit</mat-icon>
                </button>

                <button
                  class="action-btn delete"
                  (click)="eliminar(dato)"
                  title="Eliminar"
                >
                  <mat-icon>delete</mat-icon>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
